(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{1396:function(s,a,e){"use strict";e.r(a);var r=e(1),t=Object(r.a)({},(function(){var s=this,a=s.$createElement,r=s._self._c||a;return r("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[r("p",[s._v("主从模式，只存在一个master的问题\n"),r("img",{attrs:{src:e(747)}})]),s._v(" "),r("p",[s._v("于是在 redis3.0 诞生了集群模式")]),s._v(" "),r("img",{attrs:{src:e(748)}}),s._v(" "),r("h2",{attrs:{id:"_1、创建-redis-cluster-文件夹"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1、创建-redis-cluster-文件夹"}},[s._v("#")]),s._v(" 1、创建 redis-cluster 文件夹")]),s._v(" "),r("p",[s._v("在/usr/local目录下创建  redis-cluster 文件夹")]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[r("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local\n"),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" redis-cluster\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br")])]),r("img",{attrs:{src:e(749)}}),s._v(" "),r("h2",{attrs:{id:"_2、创建-7001-7006-文件夹"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2、创建-7001-7006-文件夹"}},[s._v("#")]),s._v(" 2、创建 7001-7006 文件夹")]),s._v(" "),r("p",[s._v("在 redis-cluster 中创建 7001-7006 文件夹")]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[r("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/redis-cluster\n"),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("7002")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("7003")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("7004")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("7005")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("7006")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br")])]),r("img",{attrs:{src:e(750)}}),s._v(" "),r("h2",{attrs:{id:"_3、复制redis-conf到7001-7006文件夹中"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3、复制redis-conf到7001-7006文件夹中"}},[s._v("#")]),s._v(" 3、复制"),r("code",[s._v("redis.conf")]),s._v("到7001~7006文件夹中")]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[r("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /usr/local/redis-5.0.7/redis.conf /usr/local/redis-cluster/7001/\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("h2",{attrs:{id:"_4、修改-redis-conf-中的内容"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4、修改-redis-conf-中的内容"}},[s._v("#")]),s._v(" 4、修改 redis.conf 中的内容")]),s._v(" "),r("p",[s._v("修改 7001~7006 中redis.conf 中的内容")]),s._v(" "),r("p",[s._v("进入 7001文件夹 vim redis.conf 后 输入 /bind 可以快速定位到关键字的位置")]),s._v(" "),r("img",{attrs:{src:e(751)}}),s._v(" "),r("p",[s._v("需要修改的内容如下")]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[r("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("bind")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0 "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许所有机器可以访问")]),s._v("\nport "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 暴露的端口")]),s._v("\ndaemonize "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 后台启动")]),s._v("\npidfile /var/run/redis_7001.pid "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当redis在后台运行的时候，redis会默认把pid文件放在/var/run/redis.pid下，")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 也可以配置到其它地址。当运行多个redis服务器时，需要指定不同的pid文件和端口")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("dir")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/redis-cluster/7001"')]),s._v("\nlogfile "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/log/redis/7001/redis.log"')]),s._v(" "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 日志文件 可改可不改")]),s._v("\nappendonly "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\ncluster-enabled "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启集群")]),s._v("\ncluster-config-file nodes-7001.conf "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 放开注释 每个集群节点自己的配置文件")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br")])]),r("p",[s._v("后续将 7002~7006 继续如上操作")]),s._v(" "),r("h2",{attrs:{id:"_5、启动redis集群服务"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5、启动redis集群服务"}},[s._v("#")]),s._v(" 5、启动redis集群服务")]),s._v(" "),r("p",[s._v("注意需要先安装好redis服务 "),r("RouterLink",{attrs:{to:"/cache/redis/install/"}},[s._v("redis安装->基础安装")])],1),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[r("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/redis/bin\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动 7001 ~ 7006 的集群服务")]),s._v("\n./redis-server /usr/local/redis-cluster/7001/redis.conf\n./redis-server /usr/local/redis-cluster/7002/redis.conf\n./redis-server /usr/local/redis-cluster/7003/redis.conf\n./redis-server /usr/local/redis-cluster/7004/redis.conf\n./redis-server /usr/local/redis-cluster/7005/redis.conf\n./redis-server /usr/local/redis-cluster/7006/redis.conf\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br")])]),r("p",[s._v("查看集群是否启动成功")]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[r("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ef")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" redis\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("img",{attrs:{src:e(752)}}),s._v(" "),r("h2",{attrs:{id:"_6、创建redis集群"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_6、创建redis集群"}},[s._v("#")]),s._v(" 6、创建redis集群")]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[r("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/redis/bin\n./redis-cli "),r("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--cluster")]),s._v(" create ip:7001 ip:7002 ip:7003 ip:7004 ip:7005 ip:7006 --cluster-replicas "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" \n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ip 记得替换成你自己的ip 比如我这边本地测试替换成 169.254.182.30")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --cluster-replicas 1 表示 主从 配置比 1表示的是 1:1，比如我现在6个redis服务那么 会分配 3个主3个从")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br")])]),r("img",{attrs:{src:e(753)}}),s._v(" "),r("h2",{attrs:{id:"_7、登录客户端进行测试"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_7、登录客户端进行测试"}},[s._v("#")]),s._v(" 7、登录客户端进行测试")]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[r("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/redis/bin\n./redis-cli "),r("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-h")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("169.254")]),s._v(".182.30 "),r("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br")])]),r("h3",{attrs:{id:"进行设置值测试"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#进行设置值测试"}},[s._v("#")]),s._v(" "),r("strong",[s._v("进行设置值测试")])]),s._v(" "),r("img",{attrs:{src:e(754)}}),s._v(" "),r("p",[s._v("上图可见 7001 上设置值时存储到7002上，然后7002设置值存储到7003上，然后7003设置值存储到7003，然后7003设置值存储到7002上，然后7002设置值存储到7001上")]),s._v(" "),r("blockquote",[r("p",[s._v("由此可见，主服务上面的数据之和才是所有的数据")])]),s._v(" "),r("p",[s._v("登录主服务器查看已存储的key 可以很明显观察到存储的数据")]),s._v(" "),r("img",{attrs:{src:e(755)}}),s._v(" "),r("h3",{attrs:{id:"查看主从服务器角色"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#查看主从服务器角色"}},[s._v("#")]),s._v(" "),r("strong",[s._v("查看主从服务器角色")])]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[r("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/redis/bin "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入启动目录")]),s._v("\n./redis-cli "),r("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-h")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("169.254")]),s._v(".182.30 "),r("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 登录客户端")]),s._v("\ninfo "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看当前redis服务信息")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br")])]),r("img",{attrs:{src:e(756)}}),s._v(" "),r("p",[s._v("分别登录 7001 和 7004 客户端 可以看到主从服务器的数据是一致的（主服务器的数据会自动同步到从服务器）")]),s._v(" "),r("img",{attrs:{src:e(757)}}),s._v(" "),r("p",[s._v("现在有这么个情况，如果主服务器死了，看下会发生什么情况")]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[r("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-apn")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看 7001 进程")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-9")]),s._v(" pid "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 杀死7001 主服务器")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br")])]),r("img",{attrs:{src:e(758)}}),s._v(" "),r("p",[s._v("7001 主服务器死了之后，我们登录进入 7004 中查看 info 信息")]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[s._v("./redis-cli "),r("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-h")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("169.254")]),s._v(".182.30 "),r("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("7004")]),s._v("\ninfo\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br")])]),r("img",{attrs:{src:e(759)}}),s._v(" "),r("p",[s._v("可以看见 7004 变成了主服务器，现在我们再把 7001 重启下")]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[s._v("./redis-server /usr/local/redis-cluster/7001/redis.conf "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动 7001")]),s._v("\n./redis-cli "),r("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-h")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("169.254")]),s._v(".182.30 "),r("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("7004")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入7004")]),s._v("\ninfo "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看 7004 信息")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br")])]),r("img",{attrs:{src:e(760)}}),s._v(" "),r("p",[s._v("由上图可以看见 7001 变成 7004 的从服务器了")]),s._v(" "),r("blockquote",[r("p",[s._v("总结：主服务器死了，会从 从服务器中选中一个成为主服务器，当(杀死的)主服务器重启后，将会自动变成从服务器 和 新主服务器关联")])])])}),[],!1,null,null,null);a.default=t.exports},747:function(s,a,e){s.exports=e.p+"assets/img/img_12.5c743752.png"},748:function(s,a,e){s.exports=e.p+"assets/img/1594624299524.b0e472d7.png"},749:function(s,a,e){s.exports=e.p+"assets/img/img.09f65e84.png"},750:function(s,a,e){s.exports=e.p+"assets/img/img_1.d39687f3.png"},751:function(s,a,e){s.exports=e.p+"assets/img/img_2.ab8da437.png"},752:function(s,a,e){s.exports=e.p+"assets/img/img_3.6262c588.png"},753:function(s,a,e){s.exports=e.p+"assets/img/img_4.f7ed7e94.png"},754:function(s,a,e){s.exports=e.p+"assets/img/img_5.d8f3b2f0.png"},755:function(s,a,e){s.exports=e.p+"assets/img/img_6.54e9e369.png"},756:function(s,a,e){s.exports=e.p+"assets/img/img_7.cc54cefb.png"},757:function(s,a,e){s.exports=e.p+"assets/img/img_8.ff1818ee.png"},758:function(s,a,e){s.exports=e.p+"assets/img/img_9.cb835ff9.png"},759:function(s,a,e){s.exports=e.p+"assets/img/img_10.d2f75304.png"},760:function(s,a,e){s.exports=e.p+"assets/img/img_11.21c64fb2.png"}}]);