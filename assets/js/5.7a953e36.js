(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{1031:function(s,t,a){"use strict";a.r(t);var e=a(1),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"_23年5月8号-天气晴"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_23年5月8号-天气晴"}},[s._v("#")]),s._v(" 23年5月8号：天气晴")]),s._v(" "),e("p",[s._v("又是开开心心划水的一天，直到"),e("code",[s._v("加载中")]),s._v("三个不长眼的家伙映入我的眼眶，我知道今天肯定又要不开心了，凸(艹皿艹 )")]),s._v(" "),e("img",{attrs:{src:a(461)}}),s._v(" "),e("p",[s._v("xxx告诉我xxxsb应用页面一直在加载中请求没有反应，于是我tp到xxx服务器中看下执行日志，如你所见。")]),s._v(" "),e("img",{attrs:{src:a(462)}}),s._v(" "),e("p",[s._v("看到这个想必小可爱们都能看出来，执行到这一步线程卡起了，所以这个时候就需要拿出程序猿祖传的神器"),e("code",[s._v("jvisualvm.exe")])]),s._v(" "),e("p",[s._v("怎么说呢，反正很牛皮的啊，专门用来观察和解决疑难杂症的，不会还有人不会吧！！！接下来我要开始装逼了")]),s._v(" "),e("p",[s._v("肯定是先双击打开 jdk目录下bin文件夹里面的"),e("code",[s._v("jvisualvm.exe")]),s._v(" 啦，然后就能看到神奇的一幕")]),s._v(" "),e("img",{attrs:{src:a(463)}}),s._v(" "),e("p",[s._v("堆信息可以看出来内存占用率不是很高，内存并不存在很高的峰值情况，以及守护线程和实时线程几乎没什么变化也都处于正常状态所以大概率应该不是堆内存满了导致的线程阻塞。")]),s._v(" "),e("p",[s._v("在看上上图中的阻塞线程"),e("code",[s._v("http-nio-8081-exec-332")]),s._v("所以我们打开线程的检测图看下什么情况")]),s._v(" "),e("img",{attrs:{src:a(464)}}),s._v(" "),e("p",[s._v("看我圈起来的地方，小可爱们应该能够发现该线程确实是处于阻塞状态。这个时候我们再打开"),e("code",[s._v("dump")]),s._v("查看线程具体的阻塞信息")]),s._v(" "),e("img",{attrs:{src:a(465)}}),s._v(" "),e("p",[s._v("小可爱们看不懂上图文字说明的话，不着急看我细细道来")]),s._v(" "),e("p",[s._v("上面几个截图可以判断出几个结论")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("线程被阻塞了")])]),s._v(" "),e("li",[e("p",[s._v("动态注入bean时准备从对象池里面获取对象时线程被阻塞了")])])]),s._v(" "),e("p",[s._v("所以接下来和我一起看看代码是怎么实现的哇")]),s._v(" "),e("p",[s._v("从图片"),e("code",[s._v("BaseynamicInjectBean.java.106")]),s._v("可以定位到问题的开始位置")]),s._v(" "),e("img",{attrs:{src:a(466)}}),s._v(" "),e("p",[s._v("继续下一步"),e("code",[s._v("Generic0bjeetpool.borrowObject(GenericObjectpool.java:354)")])]),s._v(" "),e("img",{attrs:{src:a(467)}}),s._v(" "),e("p",[s._v("这一步的意思是返回一个从 "),e("code",[s._v("GenericObjectPool")]),s._v("对象池中获取的对象前提是在规定的有效时间内获取，我们继续往下走")]),s._v(" "),e("p",[e("code",[s._v("Generic0bjeetpool.borrow0bjeat(Generic0bjectpool.java:437)")])]),s._v(" "),e("img",{attrs:{src:a(468)}}),s._v(" "),e("p",[e("code",[s._v("getMaxWaitMillis()")]),s._v("就是上图中的 "),e("code",[s._v("maxWaitMillis")])]),s._v(" "),e("p",[s._v("另外我们可以看看等待时间大于0的情况呢")]),s._v(" "),e("img",{attrs:{src:a(469)}}),s._v(" "),e("p",[s._v("按理来说正常情况下对象池里面的对象不应该会获取不到呀，这个就得说下 "),e("code",[s._v("GenericObjectPool")]),s._v("对象池的情况了，")]),s._v(" "),e("div",{staticClass:"language-java line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n     * Equivalent to <code>{@link #borrowObject(long)\n     * borrowObject}({@link #getMaxWaitMillis()})</code>.\n     * <p>\n     * {@inheritDoc}\n     * </p>\n     */")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("borrowObject")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("borrowObject")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("getMaxWaitMillis")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("p",[e("code",[s._v("borrowObject()")]),s._v("方法获取的是对象池中空闲的对象")]),s._v(" "),e("p",[s._v("这个时候我们去看下系统设置的对象池中最大的对象数")]),s._v(" "),e("img",{attrs:{src:a(470)}}),s._v(" "),e("p",[s._v("意思出现线程阻塞的情况有两种情况")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("对象池中空闲对象数为0")])]),s._v(" "),e("li",[e("p",[s._v("对象池中管理的对象数已经超过500(也就意味着当前500个对象都有再被使用中，真的幸福啊)")])])]),s._v(" "),e("p",[s._v("所以大概讲到这里大家应该能够猜到具体原因了，对象池里面的对象都在工作中没有被释放出去，就像热恋中的向总一样。")]),s._v(" "),e("p",[s._v("接下来带领大家本地实操复原一下")]),s._v(" "),e("h2",{attrs:{id:"犯罪现场还原"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#犯罪现场还原"}},[s._v("#")]),s._v(" 犯罪现场还原")]),s._v(" "),e("p",[s._v("准备工作")]),s._v(" "),e("h3",{attrs:{id:"设置等待一段时间情况下"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#设置等待一段时间情况下"}},[s._v("#")]),s._v(" 设置等待一段时间情况下")]),s._v(" "),e("p",[s._v("对象池配置")]),s._v(" "),e("img",{attrs:{src:a(471)}}),s._v(" "),e("p",[s._v("测试用例准备")]),s._v(" "),e("img",{attrs:{src:a(327)}}),s._v(" "),e("p",[s._v("打开jmeter 进行并发测试"),e("code",[s._v("直接上500给对象池上上强度")])]),s._v(" "),e("img",{attrs:{src:a(472)}}),s._v(" "),e("img",{attrs:{src:a(473)}}),s._v(" "),e("p",[s._v("看到这个报错我很安心，说明我们的猜测是正确的 "),e("code",[s._v("Timeout waiting for idle object")])]),s._v(" "),e("p",[s._v("意思在等待时间内未获取到指定的对象，因为500个请求进去后，现在我们对象池里面没有空闲对象了，所以我们从对象池中获取对象时，就会等待我们设置的10秒钟，若一直获取不到就会直接报错啦。")]),s._v(" "),e("h3",{attrs:{id:"设置一直等待情况下"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#设置一直等待情况下"}},[s._v("#")]),s._v(" 设置一直等待情况下")]),s._v(" "),e("img",{attrs:{src:a(474)}}),s._v(" "),e("p",[s._v("测试用例")]),s._v(" "),e("img",{attrs:{src:a(327)}}),s._v(" "),e("p",[s._v("打开jmeter 进行并发测试"),e("code",[s._v("先上100给你对象热热身")])]),s._v(" "),e("img",{attrs:{src:a(475)}}),s._v(" "),e("p",[s._v("从下图打印结果来看，现在是运行正常的，说明对象池还未满")]),s._v(" "),e("img",{attrs:{src:a(476)}}),s._v(" "),e("p",[s._v("打开jmeter 进行并发测试"),e("code",[s._v("直接上500给对象池上上强度")])]),s._v(" "),e("img",{attrs:{src:a(477)}}),s._v(" "),e("p",[s._v("可以看出当对象池对象超过500后，因为对象池中没有空闲对象，所以线程获取不到对象，然后因为我们设置的线程等待时间为无限期等待，所以线程就会出现一个阻塞的状态。")]),s._v(" "),e("h2",{attrs:{id:"解决"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#解决"}},[s._v("#")]),s._v(" 解决")]),s._v(" "),e("p",[s._v("其实很简单，只需要在用完对象后释放回对象池就行啦，就像你和你女朋友几天见一次一样，隔几天见一次就像你们一直在热恋一样呢")]),s._v(" "),e("img",{attrs:{src:a(478)}}),s._v(" "),e("p",[s._v("话不多说直接上，直接给你们的对象上 "),e("code",[s._v("500")]),s._v(" 的强度")]),s._v(" "),e("p",[s._v("从下图可以看出现在不会出现线程阻塞的问题，并且也打印了类信息")]),s._v(" "),e("img",{attrs:{src:a(479)}}),s._v(" "),e("p",[s._v("各位小可爱们基本就到这里啦")]),s._v(" "),e("p",[s._v("真tm累，凸(艹皿艹 )")])])}),[],!1,null,null,null);t.default=n.exports},327:function(s,t,a){s.exports=a.p+"assets/img/57.bf4a5a0c.png"},461:function(s,t,a){s.exports=a.p+"assets/img/46.5fbeeef7.jpg"},462:function(s,t,a){s.exports=a.p+"assets/img/47.c91e2c53.png"},463:function(s,t,a){s.exports=a.p+"assets/img/48.31e3883b.png"},464:function(s,t,a){s.exports=a.p+"assets/img/49.c0e7d5a6.png"},465:function(s,t,a){s.exports=a.p+"assets/img/50.29767234.png"},466:function(s,t,a){s.exports=a.p+"assets/img/51.7e055525.png"},467:function(s,t,a){s.exports=a.p+"assets/img/52.e4afc6c6.png"},468:function(s,t,a){s.exports=a.p+"assets/img/53.aa885fb2.png"},469:function(s,t,a){s.exports=a.p+"assets/img/54.9f8cdddd.png"},470:function(s,t,a){s.exports=a.p+"assets/img/55.013b9cfa.png"},471:function(s,t,a){s.exports=a.p+"assets/img/56.54386f86.png"},472:function(s,t,a){s.exports=a.p+"assets/img/58.d0206939.png"},473:function(s,t,a){s.exports=a.p+"assets/img/59.3e47ad0d.png"},474:function(s,t,a){s.exports=a.p+"assets/img/60.a93146f1.png"},475:function(s,t,a){s.exports=a.p+"assets/img/61.baf7b37a.png"},476:function(s,t,a){s.exports=a.p+"assets/img/62.88dacf98.png"},477:function(s,t,a){s.exports=a.p+"assets/img/63.bb028e5b.png"},478:function(s,t,a){s.exports=a.p+"assets/img/64.90d8ffa8.jpg"},479:function(s,t,a){s.exports=a.p+"assets/img/Video_2023-05-08_230731.ce20a24c.gif"}}]);