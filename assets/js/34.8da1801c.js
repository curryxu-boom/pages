(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{1394:function(s,a,e){"use strict";e.r(a);var t=e(1),n=Object(t.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("blockquote",[t("p",[s._v("Redis的2.0的时代 就出现了 一个哨兵模式")]),s._v(" "),t("p",[s._v("哨兵模式就是为了解决这个单点故障")])]),s._v(" "),t("img",{attrs:{src:e(741)}}),s._v(" "),t("blockquote",[t("p",[s._v("哨兵程序是可以部署到 任意一台服务器上的")]),s._v(" "),t("p",[s._v("这台服务器 可以是"),t("code",[s._v("Master")]),s._v("上 也可以是 "),t("code",[s._v("Slaver")]),s._v(" 上  一句话 哨兵的运行不会影响这个主程序")])]),s._v(" "),t("h2",{attrs:{id:"准备一主两从服务器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#准备一主两从服务器"}},[s._v("#")]),s._v(" 准备一主两从服务器")]),s._v(" "),t("p",[s._v("参考 "),t("RouterLink",{attrs:{to:"/cache/redis/master-slave-replication/"}},[s._v("主从复制")]),s._v(" 文章 准备一个 master 两个 slave 如下所示")],1),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("169.254.182.30 # 主服务器\n169.254.182.40:8001 # 从服务器\n169.254.182.40:8002 # 从服务器\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h2",{attrs:{id:"配置哨兵"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置哨兵"}},[s._v("#")]),s._v(" 配置哨兵")]),s._v(" "),t("p",[s._v("在任意一台"),t("code",[s._v("从服务器")]),s._v("上配置都可以")]),s._v(" "),t("h3",{attrs:{id:"_1-复制-sentinel-xml-到-etc-文件夹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-复制-sentinel-xml-到-etc-文件夹"}},[s._v("#")]),s._v(" ① 复制 sentinel.xml 到 etc 文件夹")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/redis-5.0.7\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" sentinel.conf /usr/local/redis/etc\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"_2-修改-sentinel-conf"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-修改-sentinel-conf"}},[s._v("#")]),s._v(" ② 修改 sentinel.conf")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("dir")]),s._v(" /tmp "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /tmp 修改为 /usr/local/redis/etc 添加配置文件路径")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sentinel monitor mymaster(名称随便取) ip 端口 投票选举的次数一般设为1(意思当某个从服务器拥有一票后就会变成主服务器)")]),s._v("\nsentinel monitor mymaster "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("169.254")]),s._v(".182.30 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8001")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 多久进行检测一下主节点活着没有，默认是30秒")]),s._v("\nsentinel down-after-milliseconds mymaster "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 后台启动，其实不配置这个可以，前台启动后，ctrl + c 哨兵也不会死")]),s._v("\ndaemonize "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h3",{attrs:{id:"_3-启动哨兵"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-启动哨兵"}},[s._v("#")]),s._v(" ③ 启动哨兵")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/redis/bin\n./redis-server /usr/local/redis/etc/sentinel.conf "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--sentinel")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看哨兵是否启动 哨兵默认端口就是 26379")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-apn")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("26379")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"_4-模拟哨兵进行主服务器选举过程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-模拟哨兵进行主服务器选举过程"}},[s._v("#")]),s._v(" ④ 模拟哨兵进行主服务器选举过程")]),s._v(" "),t("p",[s._v("模拟哨兵：让主服务器死  从服务器会从新进行选举")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 杀死主服务器 169.254.182.30:8001")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-apn")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8001")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-9")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2923")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("img",{attrs:{src:e(742)}}),s._v(" "),t("p",[s._v("上图可以看见当主服务器挂了之后，哨兵开始选举，将 "),t("code",[s._v("169.254.182.40:8002")]),s._v(" 选举为主服务器")]),s._v(" "),t("p",[s._v("登录 "),t("code",[s._v("169.254.182.40:8001")]),s._v("客户端查看 info信息")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("./redis-cli "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-h")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8001")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("img",{attrs:{src:e(743)}}),s._v(" "),t("p",[s._v("登录 "),t("code",[s._v("169.254.182.40:8002")]),s._v("客户端查看 info信息")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("./redis-cli "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-h")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8002")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("img",{attrs:{src:e(744)}}),s._v(" "),t("blockquote",[t("p",[t("strong",[s._v("总结")])]),s._v(" "),t("p",[s._v("由上面两图可以看见，当主服务器挂了之后，哨兵将 169.254.182.40:8002 选为主服务器，169.254.182.40:8001 作为从服务器和 169.254.182.40:8002 关联起了")])]),s._v(" "),t("p",[s._v("重启 169.254.182.30:8001 服务查看哨兵是否会进行选举")]),s._v(" "),t("img",{attrs:{src:e(745)}}),s._v(" "),t("p",[s._v("可以看见，已宕机的主服务器，当重启后将会作为从服务器关联到新选举的主服务器上")]),s._v(" "),t("blockquote",[t("p",[s._v("集群中 至少要保证一半以上的机器处于存活状态那么整个集群才处于正常状态、否则非正常状态 集群就会奔溃")])])])}),[],!1,null,null,null);a.default=n.exports},741:function(s,a,e){s.exports=e.p+"assets/img/1594612332560.b5422d9e.png"},742:function(s,a,e){s.exports=e.p+"assets/img/img.45a5a2da.png"},743:function(s,a,e){s.exports=e.p+"assets/img/img_1.5545c3a9.png"},744:function(s,a,e){s.exports=e.p+"assets/img/img_2.b0b65382.png"},745:function(s,a,e){s.exports=e.p+"assets/img/img_3.f407821b.png"}}]);