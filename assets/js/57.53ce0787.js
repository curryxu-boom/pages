(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{1426:function(s,a,t){"use strict";t.r(a);var e=t(1),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"docker-compose使用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose使用"}},[s._v("#")]),s._v(" docker-compose使用")]),s._v(" "),e("p",[e("code",[s._v("docker-compose")]),s._v(" 是用来干嘛的呢? 简单的说 是用来进行容器编排的  简单的说我们在运行 一些列容器的时候  容器的初始化可以拥有顺序")]),s._v(" "),e("img",{attrs:{src:t(793)}}),s._v(" "),e("h2",{attrs:{id:"安装docker-compose-不推荐"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装docker-compose-不推荐"}},[s._v("#")]),s._v(" 安装docker-compose(不推荐)")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安装依赖")]),s._v("\nyum "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" epel-release\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安装PIP")]),s._v("\nyum "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" python-pip\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#升级PIP")]),s._v("\npip "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--upgrade")]),s._v(" pip\n\npip "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-U")]),s._v(" docker-compose"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.23")]),s._v(".2\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("h2",{attrs:{id:"安装docker-compose-推荐"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装docker-compose-推荐"}},[s._v("#")]),s._v(" 安装docker-compose(推荐)")]),s._v(" "),e("p",[s._v("在高版本的docker中会自带 docker-compose V2版本，docker-compose 自己在本机执行一下"),e("code",[s._v("docker compose version")]),s._v("是否已经安装，如果已经安装就别重复安装。")]),s._v(" "),e("h3",{attrs:{id:"_1、安装指定版本-docker-compose"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1、安装指定版本-docker-compose"}},[s._v("#")]),s._v(" 1、安装指定版本 docker-compose")]),s._v(" "),e("p",[s._v("推荐使用V2版本，现在docker高版本自带的都是V2版本并且2023年7月起V1版本已经停止维护了，V1和V2版本使用上有些区别可以查看 "),e("a",{attrs:{href:"https://docs.docker.com/compose/migrate/",target:"_blank",rel:"noopener noreferrer"}},[s._v("docker官网compose V2版本介绍"),e("OutboundLink")],1)]),s._v(" "),e("p",[s._v("PS：通过get.daocloud.io下载的docker-compose用不了了，建议直接去官网下载"),e("a",{attrs:{href:"https://github.com/docker/compose/releases",target:"_blank",rel:"noopener noreferrer"}},[s._v("docker-compose"),e("OutboundLink")],1),s._v("上传到服务器中使用")]),s._v(" "),e("p",[s._v("通过请求下载")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 下载V1版本docker-compose 这个包差不多12.1MB")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-L")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://get.daocloud.io/docker/compose/releases/download/1.29.2/docker-compose-'),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("-"),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v('"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" /usr/local/bin/docker-compose\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 下载V2版本docker-compose 这个包差不多57.6MB")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /usr/local/lib/docker/cli-plugins\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-L")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://get.daocloud.io/docker/compose/releases/download/v2.20.0/docker-compose-'),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("-"),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v('"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" /usr/local/lib/docker/cli-plugins/docker-compose\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("PS：https://get.daocloud.io 这个地址下载可能会失败出现 503 错误，我当天部署时就出现了问题，如果这个地址下载不了可以将下载地址改为 https://github.com，如果 https://github.com 也访问不了，那就自行下载 docker-compose 包，V1版本放入 /usr/local/bin 目录 V2版本放入 /usr/local/lib/docker/cli-plugins 目录也可以，文件名称必须为 docker-compose")]),s._v(" "),e("h3",{attrs:{id:"_2、添加-docker-compose-可执行权限"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2、添加-docker-compose-可执行权限"}},[s._v("#")]),s._v(" 2、添加 docker-compose 可执行权限")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## V1版本执行")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x /usr/local/bin/docker-compose\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## V2版本执行")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x /usr/local/lib/docker/cli-plugins/docker-compose\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h3",{attrs:{id:"_3、验证是否安装成功"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3、验证是否安装成功"}},[s._v("#")]),s._v(" 3、验证是否安装成功")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## V1版本查看版本信息")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-version")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## V2版本查看版本信息")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" compose version\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h3",{attrs:{id:"_4、卸载-docker-compose"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4、卸载-docker-compose"}},[s._v("#")]),s._v(" 4、卸载 docker-compose")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## V1版本卸载")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" /usr/local/bin/docker-compose\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## V2版本卸载")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" /usr/local/lib/docker/cli-plugins/docker-compose\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h2",{attrs:{id:"编写dockerfile文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#编写dockerfile文件"}},[s._v("#")]),s._v(" 编写Dockerfile文件")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("FROM java:8\nEXPOSE "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8081")]),s._v("\nADD admin-0.0.1-SNAPSHOT.jar app.jar\nRUN "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'touch /app.jar'")]),s._v("\nENTRYPOINT "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java"')]),s._v(", "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-jar"')]),s._v(", "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/app.jar"')]),s._v(", "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--spring.profiles.active=pro"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("blockquote",[e("p",[s._v("上面几行命令其实很简单，首先依赖"),e("code",[s._v("jdk8")]),s._v("环境，对外暴露"),e("code",[s._v("8080")]),s._v("，然后就是复制"),e("code",[s._v("xxx-0.0.1-SNAPSHOT.jar")]),s._v("到"),e("code",[s._v("docker容器")]),s._v("中并命名为"),e("code",[s._v("app.jar")]),s._v("，最后是执行命令")]),s._v(" "),e("p",[e("code",[s._v("java -jar /app.jar --spring.profiles.active=pro")]),s._v("，使用的是我们另外编写的一个线上环境配置。")])]),s._v(" "),e("h2",{attrs:{id:"编写-docker-compose-yml"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#编写-docker-compose-yml"}},[s._v("#")]),s._v(" 编写 docker-compose.yml")]),s._v(" "),e("div",{staticClass:"language-yml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nginx")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#服务名称 用户自己定义")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("latest "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 镜像版本")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token datetime number"}},[s._v("80:80")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 暴露端口 右边是真实端口，左边是暴露在外的端口")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 挂载")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /root/nginx/html"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/usr/share/nginx/html\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /root/nginx/nginx.conf"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/etc/nginx/nginx.conf\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("privileged")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这个必须要，解决nginx的文件调用的权限问题")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mysql")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("8.0.19\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 3306"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#右边是真实端口，左边是暴露在外的端口")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定用户root的密码")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" MYSQL_ROOT_PASSWORD=123456\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("redis")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" redis"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("latest\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("myServer")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" myServer"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("latest\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" . "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 表示以当前目录下的Dockerfile开始构建镜像 所以这个yml文件和dockerFile文件要放一起")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 8081"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8081")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 右边是真实端口，左边是暴露在外的端口")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("depends_on")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 依赖与mysql、redis，其实可以不填，默认已经表示可以")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" mysql\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" redis\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br")])]),e("h2",{attrs:{id:"修改application-pro-yml"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修改application-pro-yml"}},[s._v("#")]),s._v(" 修改application-pro.yml")]),s._v(" "),e("p",[s._v("然后我们再回头看看"),e("code",[s._v("application-pro.yml")]),s._v("文件，"),e("code",[s._v("mysql")]),s._v("和"),e("code",[s._v("redis")]),s._v("的链接之前还是"),e("code",[s._v("localhost")]),s._v("，现在我们需要修改成容器之间的调用，如何知道"),e("code",[s._v("mysql")]),s._v("和"),e("code",[s._v("redis")]),s._v("的链接地址呢？docker compose就帮我们解决了这个问题，我们可以使用镜像容器的服务名称来表示链接。比如docker-compose.yml中mysql的服务名称就叫mysql、redis就叫redis。")]),s._v(" "),e("img",{attrs:{src:t(794)}}),s._v(" "),e("p",[s._v("所以我们最终得到的配置文件如下：")]),s._v(" "),e("img",{attrs:{src:t(795)}}),s._v(" "),e("h2",{attrs:{id:"准备好nginx的挂载目录和配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#准备好nginx的挂载目录和配置"}},[s._v("#")]),s._v(" 准备好nginx的挂载目录和配置")]),s._v(" "),e("p",[s._v("docker-compose.yml中已经提到，")]),s._v(" "),e("ul",[e("li",[s._v("宿主机的挂载目录：/root/nginx/html")]),s._v(" "),e("li",[s._v("挂载配置：/root/nginx/nginx.conf")]),s._v(" "),e("li",[s._v("所以我们在root目录下新建nginx目录，并进入nginx目录下新建html目录和一个nginx.conf配置文件。")])]),s._v(" "),e("p",[s._v("然后对nginx.conf进行编写，具体配置如下：")]),s._v(" "),e("div",{staticClass:"language-ng line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("#user  root;\nworker_processes  1;\nevents {\n    worker_connections  1024;\n}\nhttp {\n    include       mime.types;\n    default_type  application/octet-stream;\n    sendfile        on;\n    keepalive_timeout  65;\n    server {\n        listen       80;\n        server_name  localhost;\n        location / {\n            root   /usr/share/nginx/html;\n\t\t\ttry_files $uri $uri/ /index.html last; # 别忘了这个哈\n            index  index.html index.htm;\n        }\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html {\n            root   html;\n        }\n    }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br")])]),e("h2",{attrs:{id:"上传前端"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#上传前端"}},[s._v("#")]),s._v(" 上传前端")]),s._v(" "),e("p",[s._v("前端打包之后先修改前端调用后端的接口，因为我是虚拟机，所以配置如下")]),s._v(" "),e("blockquote",[e("ol",[e("li",[s._v("axios.js")]),s._v(" "),e("li",[s._v('axios.defaults.baseURL = "http://192.168.0.117:8081"')]),s._v(" "),e("li",[s._v("然后"),e("strong",[s._v("npm run build")]),s._v("打包得到"),e("strong",[s._v("dist")]),s._v("文件夹，并把dist压缩成dist.zip上传到linux之后解压到**/root/nginx/html**目录下")])])]),s._v(" "),e("h2",{attrs:{id:"部署后端"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#部署后端"}},[s._v("#")]),s._v(" 部署后端")]),s._v(" "),e("p",[e("code",[s._v("mvn clean package -Dmaven.test.skip=true")]),s._v("  跳过测试打包")]),s._v(" "),e("p",[s._v("首先本地打包"),e("code",[s._v("xxx")]),s._v("项目，xxx-0.0.1-SNAPSHOT.jar，并上传到"),e("code",[s._v("linux")]),s._v("中，同时"),e("code",[s._v("docker-compose.yml")]),s._v("、"),e("code",[s._v("Dockerfile")]),s._v("也上传到同一目录下。")]),s._v(" "),e("p",[s._v("执行下面的命令 "),e("code",[s._v("docker-compose up -d")]),s._v("    其中 -d 表示后台服务形式启动")])])}),[],!1,null,null,null);a.default=n.exports},793:function(s,a,t){s.exports=t.p+"assets/img/1597132842826.d9f342c3.png"},794:function(s,a,t){s.exports=t.p+"assets/img/1622165065(1).19485467.png"},795:function(s,a,t){s.exports=t.p+"assets/img/1622165131(1).a723526d.png"}}]);